(()=>{var e={};e.id=625,e.ids=[625],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5315:e=>{"use strict";e.exports=require("path")},7360:e=>{"use strict";e.exports=require("url")},1819:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>c,routeModule:()=>h,tree:()=>d});var a=s(6551),r=s(7605),n=s(1631),l=s.n(n),i=s(1977),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);s.d(t,o);let d=["",{children:["token-analyzer",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,4221)),"/Users/robby/zenbu-projects/sunny-bear-233/app/token-analyzer/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,3775))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,1142)),"/Users/robby/zenbu-projects/sunny-bear-233/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,7406,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,3775))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["/Users/robby/zenbu-projects/sunny-bear-233/app/token-analyzer/page.tsx"],x="/token-analyzer/page",m={require:s,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/token-analyzer/page",pathname:"/token-analyzer",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},8896:(e,t,s)=>{Promise.resolve().then(s.bind(s,3797))},331:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,1523,23)),Promise.resolve().then(s.t.bind(s,1453,23)),Promise.resolve().then(s.t.bind(s,3337,23)),Promise.resolve().then(s.t.bind(s,9863,23)),Promise.resolve().then(s.t.bind(s,7235,23)),Promise.resolve().then(s.t.bind(s,2573,23))},5502:()=>{},3797:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>C});var a=s(4330),r=s(5934);let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),i=e=>{let t=l(e);return t.charAt(0).toUpperCase()+t.slice(1)},o=(...e)=>e.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim(),d=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let x=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:s=2,absoluteStrokeWidth:a,className:n="",children:l,iconNode:i,...x},m)=>(0,r.createElement)("svg",{ref:m,...c,width:t,height:t,stroke:e,strokeWidth:a?24*Number(s)/Number(t):s,className:o("lucide",n),...!l&&!d(x)&&{"aria-hidden":"true"},...x},[...i.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(l)?l:[l]])),m=(e,t)=>{let s=(0,r.forwardRef)(({className:s,...a},l)=>(0,r.createElement)(x,{ref:l,iconNode:t,className:o(`lucide-${n(i(e))}`,`lucide-${e}`,s),...a}));return s.displayName=i(e),s},h=m("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),p=m("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),u=m("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),g=m("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);async function f(e,t){try{console.log("Calling /api/count-tokens with",e.length,"messages");let s=await fetch("/api/count-tokens",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e,apiKey:t})});if(console.log("API response status:",s.status),!s.ok){let e;let t=s.headers.get("content-type");if(t&&t.includes("text/html"))throw Error("API route not found (404). The server might need to restart.");try{e=(await s.json()).error||`API error: ${s.status}`}catch{let t=await s.text();e=`API error: ${s.status} - ${t.slice(0,100)}`}throw Error(e)}let a=await s.json();return console.log("API response data:",a),a.input_tokens||0}catch(e){throw console.error("Error counting tokens:",e),e}}function j(e){return e.reduce((e,t)=>({text:e.text+t.tokens.text,images:e.images+t.tokens.images,total:e.total+t.tokens.total}),{text:0,images:0,total:0})}async function b(e,t){try{let s=await f(e,t);console.log("Total tokens from Anthropic API:",s);let a=e.map((e,t)=>(function(e,t){var s;let a=(s=e.content,null==s?[{type:"text",tokens:0,preview:"[empty]"}]:"string"==typeof s?[{type:"text",tokens:0,preview:(s||"").slice(0,100)}]:Array.isArray(s)?0===s.length?[{type:"text",tokens:0,preview:"[empty]"}]:s.map(e=>{if("text"in e)return{type:"text",tokens:0,preview:(e.text||"").slice(0,100)};if("reasoning"in e)return{type:"reasoning",tokens:0,preview:(e.reasoning||"").slice(0,100)};if("image"in e)return{type:"image",tokens:0,preview:"string"==typeof e.image?e.image.slice(0,50):"URL"};if("type"in e&&"file"===e.type&&"mediaType"in e)return{type:"file",tokens:0,preview:`${e.filename||"file"} (${e.mediaType})`,imageUrl:e.url};if("type"in e&&"string"==typeof e.type&&e.type.startsWith("tool-")){let t;let s=e.type.replace("tool-","").split(/(?=[A-Z])/).join(" "),a=s;if("input"in e){let t=JSON.stringify(e.input);a=`${s}: ${t.slice(0,50)}`}if("output"in e){if("string"==typeof e.output)a+=` → ${e.output.slice(0,50)}`;else if("object"==typeof e.output&&null!==e.output){if("image"===e.output.type&&e.output.data)t=`data:image/jpeg;base64,${e.output.data}`,a=`${s} → screenshot (${(e.output.data.length/1024).toFixed(1)}KB)`;else{let t=JSON.stringify(e.output);a+=` → ${t.slice(0,50)}`}}}return{type:"tool-call",tokens:0,preview:a,imageUrl:t}}return{type:"unknown",tokens:0,preview:JSON.stringify(e).slice(0,100)}}):[{type:"unknown",tokens:0,preview:JSON.stringify(s).slice(0,100)}]);return{messageIndex:t,role:e.role,tokens:{text:0,images:0,total:0},parts:a}})(e,t)),r=a.reduce((e,t)=>e+t.parts.length,0);if(0===r)return a;let n=s/r;return a.map(e=>{let t=e.parts.map(()=>Math.round(n)),s=t.reduce((e,t)=>e+t,0);return{...e,tokens:{text:s,images:0,total:s},parts:e.parts.map((e,s)=>({...e,tokens:t[s]}))}})}catch(e){throw console.error("API analysis failed:",e),e}}function y({analysis:e,zoom:t,onMessageClick:s}){let n=Math.max(...e.map(e=>e.tokens.total),1),l={system:"#8b5cf6",user:"#3b82f6",assistant:"#10b981",tool:"#f59e0b"},i=(0,r.useMemo)(()=>e.map(e=>{let s=e.tokens.total/n;return{...e,intensity:s,height:Math.max(20,120*s*t)}}),[e,n,t]);return 0===e.length?null:(0,a.jsxs)("div",{className:"bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg p-6",children:[a.jsx("div",{className:"text-sm font-medium mb-4",children:"Token Distribution Heatmap"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"flex flex-col justify-between text-[10px] text-[#666] pr-2 border-r border-[#2a2a2a] min-w-[40px] items-end",children:[a.jsx("div",{children:n.toLocaleString()}),a.jsx("div",{className:"transform -rotate-90 origin-center whitespace-nowrap py-2",children:"Tokens"}),a.jsx("div",{children:"0"})]}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("div",{className:"flex items-end gap-1 overflow-x-auto pb-2",style:{minHeight:`${140*t}px`},children:i.map((e,t)=>{let r=l[e.role]||"#888";return(0,a.jsxs)("div",{className:"relative group flex-shrink-0",style:{width:`${Math.max(8,100/i.length)}px`,minWidth:"8px"},children:[a.jsx("div",{className:"rounded-sm transition-all hover:opacity-100 cursor-pointer",style:{height:`${e.height}px`,backgroundColor:r,opacity:.3+.7*e.intensity},onClick:()=>s(e.messageIndex)}),a.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 hidden group-hover:block z-10",children:(0,a.jsxs)("div",{className:"bg-[#0a0a0a] border border-[#2a2a2a] rounded px-3 py-2 text-xs whitespace-nowrap shadow-lg",children:[(0,a.jsxs)("div",{className:"font-medium mb-1",children:["Message ",e.messageIndex]}),a.jsx("div",{className:"text-[#888]",children:e.role}),(0,a.jsxs)("div",{className:"font-semibold mt-1",children:[e.tokens.total.toLocaleString()," tokens"]}),e.tokens.images>0&&(0,a.jsxs)("div",{className:"text-[#888] text-[10px]",children:[e.tokens.images," media"]}),a.jsx("div",{className:"text-[#666] text-[10px] mt-1",children:"Click to view"})]})})]},t)})}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-2 text-xs text-[#666] border-t border-[#2a2a2a] pt-2",children:[a.jsx("div",{children:"Message 0"}),a.jsx("div",{className:"text-[10px]",children:"Message Index"}),(0,a.jsxs)("div",{children:["Message ",e.length-1]})]})]})]}),a.jsx("div",{className:"flex items-center gap-4 mt-4 flex-wrap",children:Object.entries(l).map(([e,t])=>(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[a.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:t}}),a.jsx("span",{className:"text-[#888]",children:e})]},e))})]})}let v=m("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),N=m("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),w=m("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),k=({base64Data:e})=>{let[t,s]=(0,r.useState)(null),[n,l]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{let t=new Image,a=`data:image/jpeg;base64,${e}`;t.onload=()=>{let a="JPEG";e.startsWith("/9j/")?a="JPEG":e.startsWith("iVBOR")?a="PNG":e.startsWith("R0lGOD")?a="GIF":e.startsWith("UklGR")&&(a="WebP"),s({width:t.width,height:t.height,fileType:a,sizeKB:parseFloat((.75*e.length/1024).toFixed(1))}),l(!1)},t.onerror=()=>{l(!1)},t.src=a},[e]),n)?a.jsx("div",{className:"text-xs text-[#666]",children:"Loading image..."}):t?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-[#666]",children:"Resolution:"}),(0,a.jsxs)("span",{className:"text-[#aaa] ml-1",children:[t.width," \xd7 ",t.height]})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-[#666]",children:"Type:"}),a.jsx("span",{className:"text-[#aaa] ml-1",children:t.fileType})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-[#666]",children:"Size:"}),(0,a.jsxs)("span",{className:"text-[#aaa] ml-1",children:[t.sizeKB," KB"]})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-[#666]",children:"Pixels:"}),a.jsx("span",{className:"text-[#aaa] ml-1",children:(t.width*t.height).toLocaleString()})]})]}),a.jsx("img",{src:`data:image/jpeg;base64,${e}`,alt:"Screenshot",className:"max-w-full h-auto rounded border border-[#2a2a2a]",style:{maxHeight:"400px"}})]}):a.jsx("div",{className:"text-xs text-[#666]",children:"Failed to load image"})};function S({messages:e,analysis:t,zoom:s,selectedMessageId:n,apiKey:l,onUpdateAnalysis:i}){let[o,d]=(0,r.useState)(new Set),[c,x]=(0,r.useState)(new Set),[m,h]=(0,r.useState)(null),p=e=>{let t=new Set(o);t.has(e)?t.delete(e):t.add(e),d(t)},u=(e,t)=>{let s=`${e}-${t}`,a=new Set(c);a.has(s)?a.delete(s):a.add(s),x(a)},g=async s=>{if(l){h(s);try{let a=await fetch("/api/count-tokens",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[e[s]],apiKey:l})});if(!a.ok)throw Error("API call failed");let r=(await a.json()).input_tokens||0,n=e[s],o=n.content;if(Array.isArray(o)&&o.length>0){let e=await Promise.all(o.map(async e=>{try{let t={role:n.role,content:[e]},s=await fetch("/api/count-tokens",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[t],apiKey:l})});if(!s.ok)return 0;return(await s.json()).input_tokens||0}catch{return 0}})),a=t[s],d={...a,tokens:{text:r,images:0,total:r},parts:a.parts.map((t,s)=>({...t,tokens:e[s]||0}))};i(s,d)}}catch(e){console.error("Error calculating tokens:",e)}finally{h(null)}}},f={system:"#8b5cf6",user:"#3b82f6",assistant:"#10b981",tool:"#f59e0b"};return(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-sm font-medium mb-3",children:"Messages"}),t.map(t=>{let s=e[t.messageIndex],r=o.has(t.messageIndex),l=n===t.messageIndex,i=f[t.role]||"#888";return(0,a.jsxs)("div",{id:`message-${t.messageIndex}`,className:`bg-[#1a1a1a] border rounded-lg overflow-hidden transition-all ${l?"border-[#4a4a4a] ring-2 ring-[#3a3a3a]":"border-[#2a2a2a]"}`,children:[a.jsx("button",{onClick:()=>p(t.messageIndex),className:`w-full px-4 py-3 flex items-center justify-between transition-colors text-left ${l?"bg-[#252525]":"hover:bg-[#1f1f1f]"}`,children:(0,a.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[r?a.jsx(v,{size:16}):a.jsx(N,{size:16}),a.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:i}}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("span",{className:"font-medium",children:["Message ",t.messageIndex]}),a.jsx("span",{className:"text-[#888] ml-2",children:t.role})]}),(0,a.jsxs)("div",{className:"text-sm text-[#888] flex items-center gap-4 flex-shrink-0",children:[t.parts.length>1&&(0,a.jsxs)("span",{className:"text-xs",children:[t.parts.length," parts"]}),(0,a.jsxs)("span",{className:"font-medium",children:[t.tokens.total," tokens"]})]})]})}),r&&(0,a.jsxs)("div",{className:"px-4 pb-4 space-y-4",children:[a.jsx("button",{onClick:()=>g(t.messageIndex),disabled:m===t.messageIndex,className:"w-full py-2 px-3 bg-[#2a2a2a] hover:bg-[#3a3a3a] disabled:opacity-50 disabled:cursor-not-allowed rounded flex items-center justify-center gap-2 text-sm transition-colors",children:m===t.messageIndex?(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),a.jsx("span",{children:"Calculating accurate tokens..."})]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(w,{size:14}),a.jsx("span",{children:"Calculate Accurate Token Breakdown"})]})}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("div",{className:"text-xs text-[#888] font-medium",children:"Token Breakdown"}),t.parts.map((e,r)=>{let n=e.tokens/t.tokens.total*100,l=`${t.messageIndex}-${r}`,o=c.has(l),d="tool-call"===e.type,x=e.type;if(d){let e=s.content;if(Array.isArray(e)&&e[r]){let t=e[r];t.type?.startsWith("tool-")&&(x=t.type.replace("tool-","").replace(/([A-Z])/g," $1").trim())}}return(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("button",{onClick:()=>{d&&u(t.messageIndex,r)},className:`w-full flex items-center justify-between text-xs ${d?"hover:bg-[#252525] rounded px-2 py-1 cursor-pointer":""}`,children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-[#aaa]",children:x}),d&&(o?a.jsx(v,{size:12}):a.jsx(N,{size:12}))]}),(0,a.jsxs)("span",{className:"text-[#888]",children:[e.tokens.toLocaleString()," tokens (",n.toFixed(1),"%)"]})]}),a.jsx("div",{className:"h-1.5 bg-[#0f0f0f] rounded-full overflow-hidden",children:a.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${n}%`,backgroundColor:i,opacity:.6}})}),d&&o&&a.jsx("div",{className:"mt-2 ml-4 p-3 bg-[#0f0f0f] rounded border border-[#2a2a2a]",children:(()=>{let t=s.content;if(Array.isArray(t)&&t[r]){let e=t[r],s=e.type?.replace("tool-","").replace(/([A-Z])/g," $1").trim()||"Unknown Tool";return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-xs text-[#666] mb-1",children:"Tool Name:"}),a.jsx("div",{className:"text-xs text-[#ddd] font-medium",children:s})]}),e.input&&(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-xs text-[#666] mb-1",children:"Input:"}),a.jsx("pre",{className:"text-xs text-[#999] whitespace-pre-wrap break-words font-mono p-2 bg-[#1a1a1a] rounded",children:JSON.stringify(e.input,null,2)})]}),e.output&&(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-xs text-[#666] mb-1",children:"Output:"}),"image"===e.output.type&&e.output.data?a.jsx(k,{base64Data:e.output.data}):a.jsx("pre",{className:"text-xs text-[#999] whitespace-pre-wrap break-words font-mono p-2 bg-[#1a1a1a] rounded max-h-[300px] overflow-y-auto",children:"string"==typeof e.output?e.output:JSON.stringify(e.output,null,2)})]}),e.state&&(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-xs text-[#666] mb-1",children:"State:"}),a.jsx("div",{className:"text-xs text-[#999]",children:e.state})]}),(0,a.jsxs)("div",{children:[a.jsx("div",{className:"text-xs text-[#666] mb-1",children:"Raw Tool Call Data (sent to Anthropic):"}),a.jsx("pre",{className:"text-xs text-[#999] whitespace-pre-wrap break-words font-mono p-2 bg-[#1a1a1a] rounded max-h-[400px] overflow-y-auto",children:JSON.stringify(e,(e,t)=>"data"===e&&"string"==typeof t&&t.length>100?t.substring(0,100)+`... [${t.length} chars total, ${(.75*t.length/1024).toFixed(1)}KB]`:t,2)}),(0,a.jsxs)("div",{className:"text-xs text-[#666] mt-2",children:["Structure size: ",JSON.stringify(e).length.toLocaleString()," characters",e.output?.data&&(0,a.jsxs)(a.Fragment,{children:[" • Base64 length: ",e.output.data.length.toLocaleString()," chars"]})]})]})]})}return a.jsx("div",{className:"text-xs text-[#999] whitespace-pre-wrap break-words font-mono",children:e.preview})})()})]},r)})]})]})]},t.messageIndex)})]})}function A({analysis:e}){let t=j(e),s=e.reduce((e,t)=>(e[t.role]||(e[t.role]={text:0,images:0,total:0}),e[t.role].text+=t.tokens.text,e[t.role].images+=t.tokens.images,e[t.role].total+=t.tokens.total,e),{}),r={system:"#8b5cf6",user:"#3b82f6",assistant:"#10b981",tool:"#f59e0b"};return(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg p-4",children:[a.jsx("div",{className:"text-sm text-[#888] mb-1",children:"Total Tokens"}),a.jsx("div",{className:"text-2xl font-semibold",children:t.total.toLocaleString()}),(0,a.jsxs)("div",{className:"text-xs text-[#666] mt-2",children:[t.text.toLocaleString()," text + ",t.images.toLocaleString()," media"]})]}),Object.entries(s).map(([e,s])=>(0,a.jsxs)("div",{className:"bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"text-sm text-[#888] mb-1 flex items-center gap-2",children:[a.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:r[e]||"#888"}}),e.charAt(0).toUpperCase()+e.slice(1)]}),a.jsx("div",{className:"text-2xl font-semibold",children:s.total.toLocaleString()}),(0,a.jsxs)("div",{className:"text-xs text-[#666] mt-2",children:[(s.total/t.total*100).toFixed(1),"% of total"]})]},e))]})}function C(){let[e,t]=(0,r.useState)([]),[s,n]=(0,r.useState)(null),[l,i]=(0,r.useState)(""),[o,d]=(0,r.useState)("all"),[c,x]=(0,r.useState)(""),[m,f]=(0,r.useState)(!1),[v,N]=(0,r.useState)(1),[w,k]=(0,r.useState)(!1),[C,P]=(0,r.useState)(""),[I,$]=(0,r.useState)(null),[z,T]=(0,r.useState)(null),[M,L]=(0,r.useState)(!1),[O,F]=(0,r.useState)(null),[_,E]=(0,r.useState)(null),U=async e=>{let t=e.target.files?.[0];if(!t||!c)return;L(!0),T(null),F(null),E(null);let s=new FileReader;s.onload=async e=>{try{let s=(e.target?.result).split(",")[1],a=t.type;F(e.target?.result);let r=new Image;r.onload=async()=>{E({width:r.width,height:r.height,sizeKB:parseFloat((t.size/1024).toFixed(1)),base64Length:s.length});let e={messages:[{role:"user",content:[{type:"image",source:{type:"base64",media_type:a,data:s}}]}],apiKey:c};console.log("Image upload request:",{...e,messages:[{...e.messages[0],content:[{...e.messages[0].content[0],source:{...e.messages[0].content[0].source,data:`[${s.length} chars]`}}]}]});let n=await fetch("/api/count-tokens",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw Error("API call failed");let l=await n.json();console.log("Token count response:",l),T(l.input_tokens||0),L(!1)},r.src=e.target?.result}catch(e){console.error("Error counting image tokens:",e),P("Failed to count image tokens"),L(!1)}},s.readAsDataURL(t)},J=(0,r.useCallback)(async e=>{let s=e.target.files?.[0];if(!s)return;k(!0),P(""),n(null);let a=new FileReader;a.onload=async e=>{try{let s;let a=JSON.parse(e.target?.result);if(Array.isArray(a))s=a;else if(a.data&&a.data.messages&&Array.isArray(a.data.messages))s=a.data.messages;else if(a.messages&&Array.isArray(a.messages))s=a.messages;else{P('Invalid format. Expected array of messages, object with "messages" field, or object with "data.messages" field.'),k(!1);return}if(s=s.map(e=>e.parts&&!e.content?{...e,content:e.parts}:e),0===s.length){P("No messages found in the file."),k(!1);return}let r=new Map;s.forEach(e=>{let t=e.metadata,s=t?.chatId||"default";r.has(s)||r.set(s,{messages:[],createdAt:t?.createdAt||0});let a=r.get(s);a&&a.messages.push(e)});let n=[];if(!c){P("Anthropic API key required for accurate token counting. Please set your API key in settings."),k(!1);return}for(let[e,t]of r.entries()){let s=t.messages.sort((e,t)=>{let s=e.metadata,a=t.metadata;return(s?.createdAt||0)-(a?.createdAt||0)}),a=await b(s,c),r=j(a);n.push({chatId:e,messages:s,analysis:a,createdAt:t.createdAt,messageCount:s.length,totalTokens:r.total})}n.sort((e,t)=>t.createdAt-e.createdAt),t(n),k(!1)}catch(e){P("Failed to parse JSON: "+e.message),k(!1)}},a.onerror=()=>{P("Failed to read file"),k(!1)},a.readAsText(s)},[c]),q=s?s.analysis.filter(e=>{let t="all"===o||e.role===o,s=""===l||e.parts.some(e=>e.preview?.toLowerCase().includes(l.toLowerCase()));return t&&s}):[],B=e.reduce((e,t)=>e+t.totalTokens,0);return(0,a.jsxs)("div",{className:"min-h-screen bg-[#0a0a0a] text-white",children:[a.jsx("div",{className:"border-b border-[#1a1a1a] bg-[#0f0f0f]",children:(0,a.jsxs)("div",{className:"max-w-[1800px] mx-auto px-6 py-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[s&&a.jsx("button",{onClick:()=>n(null),className:"p-2 hover:bg-[#1a1a1a] rounded-md transition-colors",children:a.jsx(h,{size:18})}),a.jsx("h1",{className:"text-lg font-semibold",children:"AI SDK Token Analyzer"}),s&&(0,a.jsxs)("div",{className:"text-sm text-[#888]",children:[s.messageCount," messages • ",s.totalTokens.toLocaleString()," tokens"]}),!s&&e.length>0&&(0,a.jsxs)("div",{className:"text-sm text-[#888]",children:[e.length," chats • ",B.toLocaleString()," total tokens"]})]}),a.jsx("button",{onClick:()=>f(!0),className:"p-2 hover:bg-[#1a1a1a] rounded-md transition-colors",children:a.jsx(p,{size:18})})]})}),(0,a.jsxs)("div",{className:"max-w-[1800px] mx-auto px-6 py-6",children:[!c&&(0,a.jsxs)("div",{className:"mb-4 p-4 bg-red-900/20 border border-red-500/50 rounded-lg text-red-200",children:[a.jsx("div",{className:"font-medium mb-1",children:"⚠️ API Key Required"}),a.jsx("div",{className:"text-sm",children:"Set your Anthropic API key in settings to get accurate token counts from Claude Sonnet 4.5. Without it, token counts cannot be calculated."})]}),C&&(0,a.jsxs)("div",{className:"mb-4 p-4 bg-red-900/20 border border-red-500/50 rounded-lg text-red-200 flex items-center justify-between",children:[a.jsx("span",{children:C}),a.jsx("button",{onClick:()=>P(""),className:"ml-4 p-1 hover:bg-red-800/30 rounded transition-colors",children:a.jsx(u,{size:18})})]}),0===e.length?(0,a.jsxs)("div",{className:"space-y-6",children:[c&&a.jsx("div",{className:"max-w-2xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg p-6",children:[a.jsx("h3",{className:"text-lg font-medium mb-4",children:"Image Token Counter"}),a.jsx("p",{className:"text-sm text-[#888] mb-4",children:"Upload an image to see how many tokens it uses"}),(0,a.jsxs)("label",{className:"cursor-pointer block",children:[a.jsx("input",{type:"file",accept:"image/*",onChange:U,className:"hidden",disabled:M}),a.jsx("div",{className:"border-2 border-dashed border-[#2a2a2a] rounded-lg p-6 hover:border-[#3a3a3a] transition-colors text-center",children:M?(0,a.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"}),a.jsx("span",{className:"text-sm text-[#888]",children:"Counting tokens..."})]}):a.jsx("div",{className:"text-sm text-[#888]",children:"Click to upload image"})})]}),O&&null!==z&&(0,a.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-[#0f0f0f] rounded",children:[a.jsx("span",{className:"text-sm text-[#888]",children:"Token Count (from Anthropic API):"}),a.jsx("span",{className:"text-lg font-semibold text-white",children:z.toLocaleString()})]}),_&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 p-3 bg-[#0f0f0f] rounded text-xs",children:[(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-[#666]",children:"Resolution:"}),(0,a.jsxs)("span",{className:"text-[#aaa] ml-1",children:[_.width," \xd7 ",_.height]})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-[#666]",children:"File Size:"}),(0,a.jsxs)("span",{className:"text-[#aaa] ml-1",children:[_.sizeKB," KB"]})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-[#666]",children:"Pixels:"}),a.jsx("span",{className:"text-[#aaa] ml-1",children:(_.width*_.height).toLocaleString()})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-[#666]",children:"Base64 Length:"}),a.jsx("span",{className:"text-[#aaa] ml-1",children:_.base64Length.toLocaleString()})]})]}),a.jsx("img",{src:O,alt:"Uploaded",className:"max-w-full h-auto rounded border border-[#2a2a2a]",style:{maxHeight:"300px"}})]})]})}),a.jsx("div",{className:"flex items-center justify-center",children:(0,a.jsxs)("label",{className:"cursor-pointer",children:[a.jsx("input",{type:"file",accept:".json",onChange:J,className:"hidden",disabled:w}),a.jsx("div",{className:"flex flex-col items-center gap-4 p-12 border-2 border-dashed border-[#2a2a2a] rounded-lg hover:border-[#3a3a3a] transition-colors",children:w?(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white"}),a.jsx("div",{className:"text-center",children:a.jsx("div",{className:"text-lg font-medium mb-1",children:"Processing file..."})})]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx(g,{size:48,className:"text-[#666]"}),(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"text-lg font-medium mb-1",children:"Upload AI SDK Messages"}),a.jsx("div",{className:"text-sm text-[#888]",children:'JSON array or object with "messages" or "data.messages" field'})]})]})})]})})]}):s?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-wrap",children:[a.jsx("input",{type:"text",placeholder:"Search messages...",value:l,onChange:e=>i(e.target.value),className:"px-4 py-2 bg-[#1a1a1a] border border-[#2a2a2a] rounded-md focus:outline-none focus:border-[#3a3a3a] flex-1 min-w-[200px]"}),(0,a.jsxs)("select",{value:o,onChange:e=>d(e.target.value),className:"px-4 py-2 bg-[#1a1a1a] border border-[#2a2a2a] rounded-md focus:outline-none focus:border-[#3a3a3a]",children:[a.jsx("option",{value:"all",children:"All Roles"}),a.jsx("option",{value:"system",children:"System"}),a.jsx("option",{value:"user",children:"User"}),a.jsx("option",{value:"assistant",children:"Assistant"}),a.jsx("option",{value:"tool",children:"Tool"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>N(Math.max(.5,v-.1)),className:"px-3 py-2 bg-[#1a1a1a] border border-[#2a2a2a] rounded-md hover:bg-[#252525] transition-colors",children:"-"}),(0,a.jsxs)("span",{className:"text-sm text-[#888] w-12 text-center",children:[Math.round(100*v),"%"]}),a.jsx("button",{onClick:()=>N(Math.min(2,v+.1)),className:"px-3 py-2 bg-[#1a1a1a] border border-[#2a2a2a] rounded-md hover:bg-[#252525] transition-colors",children:"+"})]})]}),a.jsx(A,{analysis:s.analysis}),a.jsx(y,{analysis:q,zoom:v,onMessageClick:e=>{$(e);let t=document.getElementById(`message-${e}`);t&&t.scrollIntoView({behavior:"smooth",block:"center"})}}),a.jsx(S,{messages:s.messages,analysis:q,zoom:v,selectedMessageId:I,apiKey:c,onUpdateAnalysis:(a,r)=>{if(s){let l=[...s.analysis];l[a]=r;let i=j(l),o={...s,analysis:l,totalTokens:i.total};n(o),t(e.map(e=>e.chatId===s.chatId?o:e))}}})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-sm font-medium",children:"Chats"}),(0,a.jsxs)("label",{className:"cursor-pointer",children:[a.jsx("input",{type:"file",accept:".json",onChange:J,className:"hidden"}),a.jsx("div",{className:"px-4 py-2 bg-[#1a1a1a] border border-[#2a2a2a] rounded-md hover:bg-[#252525] transition-colors text-sm",children:"New File"})]})]}),a.jsx("div",{className:"grid gap-4",children:e.map(e=>{let t=(()=>{let t=e.messages.find(e=>"user"===e.role);if(!t)return null;if("string"==typeof t.content)return t.content.slice(0,120);if(Array.isArray(t.content)){let e=t.content.find(e=>"text"===e.type);if(e&&"text"in e)return e.text.slice(0,120)}return null})();return(0,a.jsxs)("button",{onClick:()=>n(e),className:"bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg p-5 hover:border-[#3a3a3a] hover:bg-[#1f1f1f] transition-all text-left",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4 mb-3",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-baseline gap-3 mb-2",children:[a.jsx("h3",{className:"font-medium text-white text-sm truncate",children:e.chatId}),a.jsx("span",{className:"text-xs text-[#999] whitespace-nowrap",children:(e=>{let t=Date.now()-e,s=Math.floor(t/6e4),a=Math.floor(t/36e5),r=Math.floor(t/864e5);return s<1?"just now":s<60?`${s}m ago`:a<24?`${a}h ago`:r<7?`${r}d ago`:new Date(e).toLocaleDateString()})(e.createdAt)})]}),t&&a.jsx("p",{className:"text-sm text-[#888] line-clamp-2 leading-relaxed",children:t})]}),(0,a.jsxs)("div",{className:"text-right flex-shrink-0",children:[a.jsx("div",{className:"text-3xl font-bold text-white mb-0.5",children:e.totalTokens>=1e3?`${(e.totalTokens/1e3).toFixed(1)}K`:e.totalTokens}),a.jsx("div",{className:"text-xs text-[#666] uppercase tracking-wider",children:"tokens"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-xs text-[#666]",children:[(0,a.jsxs)("span",{children:[e.messageCount," messages"]}),a.jsx("span",{children:"•"}),(0,a.jsxs)("span",{children:[Math.round(e.totalTokens/e.messageCount)," avg"]})]})]},e.chatId)})})]})]}),m&&a.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-[#1a1a1a] border border-[#2a2a2a] rounded-lg p-6 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-lg font-semibold",children:"Settings"}),a.jsx("button",{onClick:()=>f(!1),className:"p-1 hover:bg-[#252525] rounded transition-colors",children:a.jsx(u,{size:18})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-[#888] mb-2",children:"Anthropic API Key"}),a.jsx("input",{type:"password",value:c,onChange:e=>x(e.target.value),placeholder:"sk-ant-...",className:"w-full px-4 py-2 bg-[#0f0f0f] border border-[#2a2a2a] rounded-md focus:outline-none focus:border-[#3a3a3a]"}),a.jsx("div",{className:"text-xs text-[#666] mt-2",children:"Stored locally in your browser"})]}),a.jsx("button",{onClick:()=>{localStorage.setItem("anthropic-api-key",c),f(!1)},className:"w-full px-4 py-2 bg-[#2a2a2a] hover:bg-[#333] rounded-md transition-colors",children:"Save"})]})]})})]})}},1142:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d,metadata:()=>o});var a=s(7727),r=s(7336),n=s.n(r),l=s(2633),i=s.n(l);s(2653);let o={title:"Create Next App",description:"Generated by create next app"};function d({children:e}){return a.jsx("html",{lang:"en",suppressHydrationWarning:!0,className:`${n().variable} ${i().variable}`,children:a.jsx("body",{className:"antialiased",suppressHydrationWarning:!0,children:e})})}},4221:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(1070).createProxy)(String.raw`/Users/robby/zenbu-projects/sunny-bear-233/app/token-analyzer/page.tsx#default`)},3775:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});var a=s(8774);let r=e=>[{type:"image/x-icon",sizes:"16x16",url:(0,a.fillMetadataSegment)(".",e.params,"favicon.ico")+""}]},2653:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[356,540,774],()=>s(1819));module.exports=a})();